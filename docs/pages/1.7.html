<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<title>STGL</title>
<link rel="stylesheet" type="text/css" href="..//css/stdoc.css"/>
<script type="text/javascript" src="..//js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="..//js/stdoc.js"></script>
</head>
<body>
<div id="div_model" style="display:none">BOOK</div>
<div id="div_body">
<div id="div_logo"></div>
<div id="div_left">
<div id="div_left_list">
<ul class='ul_group_root'>
<li>
    <a class='a_node_root anchor_btn' name='a_a' href='#a_a'>纹理</a>
    <ul>
        <li class='li_node_sub'><a class='anchor_btn' name='a_b' href='#a_b'>纹理坐标</a></li>
        <li class='li_node_sub'><a class='anchor_btn' name='a_c' href='#a_c'>纹理的环绕方式</a></li>
        <li class='li_node_sub'><a class='anchor_btn' name='a_d' href='#a_d'>纹理过滤</a></li>
        <li class='li_node_sub'><a class='anchor_btn' name='a_e' href='#a_e'>多级渐远纹理</a></li>
        <li class='li_node_sub'><a class='anchor_btn' name='a_f' href='#a_f'>像素提取</a></li>
        <li class='li_node_sub'><a class='anchor_btn' name='a_g' href='#a_g'>创建纹理</a></li>
        <li class='li_node_sub'><a class='anchor_btn' name='a_h' href='#a_h'>纹理单元</a></li>
    </ul>
</li>
</ul><div class='div_left_space_space'></div>
</div>
<span id="span_time">2022-08-06 -> by:<span>DebugST</span></span>
</div>
<div id="div_right">
<span class='span_location'>1.入门 &gt; 7.纹理<span style='float:right'>2022-08-05</span></span><h1 class='h_title anchor_point' name='a_a'>纹理</h1>
<p>在前面的章节中，我们可以通过指定顶点的颜色为我们的绘制增加一些效果，可是仅仅是颜色显然是不够的，我们可能需要更多的细节，我比我们要绘制一个箱子，我们不可能去指定每一个像素的颜色，这个时候我们可能需要一个更简单的方式，比如<span class='mark'>贴图</span>。也被称之为<span class='mark'>纹理</span>。</p>
<p>在本章节中我们将使用<span class='mark'>你好 四边形</span>的案例，以及准备了下面的素材，读者可以<span class='mark'>右键</span>将素材保存。</p>
<img width=170 src='../images/1.7.container.png'/>
<img width=170 src='../images/1.7.awesomeface.png'/>
<div><h2 class='h_option anchor_point' name='a_b'>纹理坐标</h2></div>
<p>一张图必然是<span class='mark'>矩形</span>，为了和我们绘制的平面关联，必然会给它指定一个坐标，通常我们称之为<span class='mark'>UV</span>坐标当然也叫做<span class='mark'>ST</span>坐标。</p>
<img src='../images/1.7.texcoords.png'/>
<p>一张图的左下角为原点坐标<span class='mark'>(0,0)</span>，右上角为<span class='mark'>(1,1)</span>。有了坐标就可以和我们绘制平面的顶点进行关联了。</p>
<p>如果我们希望在之前的<span class='mark'>三角形</span>上面贴上上面的箱子图案的话我们可以这样为每个顶点指定纹理坐标。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>[]</span> texCoords <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(255,255,255,1)'>{</span>
<span class='span_code_line'></span>    <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 左下角</span>
<span class='span_code_line'></span>    <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 右下角</span>
<span class='span_code_line'></span>    <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span> <span style='color:rgba(0,255,0,1)'>// 上中</span>
<span class='span_code_line'></span><span style='color:rgba(255,255,255,1)'>};</span></pre>
</div>
<p>和指定颜色一样，<span class='mark'>OpenGL</span>会自动为我们插值，补全其余的像素。</p>
<div class='div_hightlight' style='background-color:skyblue;color:black'>
<p>U = S = x dimension, V = T = y dimension</p>
</div>
<div><h2 class='h_option anchor_point' name='a_c'>纹理的环绕方式</h2></div>
<p>可以看到纹理的坐标是<span class='mark'>0-1</span>，那么如果指定给顶点的纹理坐标超出这个范围会怎么样呢？<span class='mark'>OpenGL</span>提供了几种方式处理他们。</p>
<div class='div_table'>
<table>
<tr><th>常量值</th><th>说明</th></tr>
<tr><td>GL_REPEAT</td><td>对纹理的默认行为。重复纹理图像。</td></tr>
<tr class='tr_hight'><td>GL_MIRRORED_REPEAT</td><td>和GL_REPEAT一样，但每次重复图片是镜像放置的。</td></tr>
<tr><td>GL_CLAMP_TO_EDGE</td><td>纹理坐标会被约束在0到1之间，超出的部分会重复纹理坐标的边缘，产生一种边缘被拉伸的效果。</td></tr>
<tr class='tr_hight'><td>GL_CLAMP_TO_BORDER</td><td>超出的坐标为用户指定的边缘颜色。</td></tr>
</table>
</div>
<p>效果图。</p>
<img src='../images/1.7.texture_wrapping.png'/>
<p>我们可以通过<span class='mark'>glTexParameteri</span>去设置当前<span class='mark'>Context</span>所操作的纹理的环绕方式。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_WRAP_S</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_MIRRORED_REPEAT</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_WRAP_T</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_MIRRORED_REPEAT</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>由于我们使用使用的图片是2维的，所以我们使用<span class='mark'>GL_TEXTURE_2D</span>告诉<span class='mark'>OpenGL</span>我们当前操作的是一个2D纹理，<span class='mark'>GL_TEXTURE_WRAP_S</span>则表示水平方向上的坐标（<span class='mark'>X</span>）。第三个参数则是环绕方式。</p>
<p>如果我们选择<span class='mark'>GL_CLAMP_TO_BORDER</span>选项，我们还需要指定一个边缘的颜色。这需要使用<span class='mark'>glTexParameter</span>函数的<span class='mark'>fv</span>后缀形式，用<span class='mark'>GL_TEXTURE_BORDER_COLOR</span>作为它的选项，并且传递一个<span class='mark'>float</span>数组作为边缘的颜色值：</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>[]</span> borderColor <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(255,255,255,1)'>{</span> r<span style='color:rgba(255,255,255,1)'>,</span> g<span style='color:rgba(255,255,255,1)'>,</span> b<span style='color:rgba(255,255,255,1)'>,</span> a <span style='color:rgba(255,255,255,1)'>};</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameterfv</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_BORDER_COLOR</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(30,144,255,1)'>ref</span> borderColor<span style='color:rgba(255,255,255,1)'>[</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>]);</span></pre>
</div>
<div><h2 class='h_option anchor_point' name='a_d'>纹理过滤</h2></div>
<p>我们使用的2D纹理是一张图片，它是有分辨率大小的，当贴在一个物体表面的时候必然会产生一些像素的映射，而在图片中像素的单位是<span class='mark'>整数</span>的，事实上真实的渲染中很难做到，刚好图片中的每个像素都能对应物体表面的每一个像素。最典型的一个例子就是，在<span class='mark'>3D</span>空间中，我们的物体是可以放大缩小的，而图片的分辨率确实固定的。</p>
<p>而纹理的过滤方式可以告诉<span class='mark'>OpenGL</span>面对这种情况的时候应当如何处理。<span class='mark'>OpenGL</span>纹理过滤有很多个选项，但是现在我们只讨论最重要的两种：<span class='mark'>GL_NEAREST</span>和<span class='mark'>GL_LINEAR</span>。</p>
<p><span class='mark'>GL_NEAREST</span>（也叫邻近过滤，Nearest Neighbor Filtering）是<span class='mark'>OpenGL</span>默认的纹理过滤方式。当设置为<span class='mark'>GL_NEAREST</span>的时候，<span class='mark'>OpenGL</span>会选择中心点最接近纹理坐标的那个像素。下图中你可以看到四个像素，加号代表纹理坐标。左上角那个纹理像素的中心距离纹理坐标最近，所以它会被选择为样本颜色：</p>
<img src='../images/1.7.filter_nearest.png'/>
<p><span class='mark'>GL_LINEAR</span>（也叫线性过滤，(Bi)linear Filtering）它会基于纹理坐标附近的纹理像素，计算出一个插值，近似出这些纹理像素之间的颜色。一个纹理像素的中心距离纹理坐标越近，那么这个纹理像素的颜色对最终的样本颜色的贡献越大。下图中你可以看到返回的颜色是邻近像素的混合色：</p>
<img src='../images/1.7.filter_linear.png'/>
<p>那么这两种纹理过滤方式有怎样的视觉效果呢？让我们看看在一个很大的物体上应用一张低分辨率的纹理会发生什么吧（纹理被放大了，每个纹理像素都能看到）：</p>
<img src='../images/1.7.texture_filtering.png'/>
<p><span class='mark'>GL_NEAREST</span>更像是以马赛克的方式处理，而<span class='mark'>GL_LINEAR</span>则会自动补插。</p>
<p>当进行放大(Magnify)和缩小(Minify)操作的时候可以设置纹理过滤的选项，比如你可以在纹理被缩小的时候使用邻近过滤，被放大时使用线性过滤。我们需要使用<span class='mark'>glTexParameter*</span>函数为放大和缩小指定过滤方式。这段代码看起来会和纹理环绕方式的设置很相似：</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_MIN_FILTER</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_NEAREST</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_MAG_FILTER</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_LINEAR</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<div><h2 class='h_option anchor_point' name='a_e'>多级渐远纹理</h2></div>
<p>假设我们做了一个游戏场景，有一个箱子，为了让箱子看上去更加的逼真我们使用了一个很高分辨率的纹理，但是现在这个现在在一个很远的地方，在屏幕上可能只占了极少的像素。渲染时将造成极大的资源浪费。所以我们希望遇到类似的情况仅仅使用一张很小分辨率的纹理渲染就可以了。</p>
<p>想一想这个场景是不是很常见？比如我们使用的地图软件。当我们把地图缩小的时候一些街道根本就不会显示，也是差不多的原理。</p>
<p><span class='mark'>OpenGL</span>使用一种叫做多级渐远纹理(Mipmap)的概念来解决这个问题，它简单来说就是一系列的纹理图像，后一个纹理图像是前一个的二分之一。多级渐远纹理背后的理念很简单：距观察者的距离超过一定的阈值，<span class='mark'>OpenGL</span>会使用不同的多级渐远纹理，即最适合物体的距离的那个。由于距离远，解析度不高也不会被用户注意到。同时，多级渐远纹理另一加分之处是它的性能非常好。让我们看一下多级渐远纹理是什么样子的：</p>
<img src='../images/1.7.mipmaps.png'/>
<p>手工为每个纹理图像创建一系列多级渐远纹理很麻烦，幸好<span class='mark'>OpenGL</span>有一个<span class='mark'>glGenerateMipmaps</span>函数，在创建完一个纹理后调用它<span class='mark'>OpenGL</span>就会承担接下来的所有工作了。后面的教程中你会看到该如何使用它。</p>
<p>在渲染中切换多级渐远纹理级别(Level)时，<span class='mark'>OpenGL</span>在两个不同级别的多级渐远纹理层之间会产生不真实的生硬边界。就像普通的纹理过滤一样，切换多级渐远纹理级别时你也可以在两个不同多级渐远纹理级别之间使用<span class='mark'>NEAREST</span>和<span class='mark'>LINEAR</span>过滤。为了指定不同多级渐远纹理级别之间的过滤方式，你可以使用下面四个选项中的一个代替原有的过滤方式：</p>
<div class='div_table'>
<table>
<tr><th>常量值</th><th>说明</th></tr>
<tr><td>GL_NEAREST_MIPMAP_NEAREST</td><td>使用最邻近的多级渐远纹理来匹配像素大小，并使用邻近插值进行纹理采样</td></tr>
<tr class='tr_hight'><td>GL_LINEAR_MIPMAP_NEAREST</td><td>使用最邻近的多级渐远纹理级别，并使用线性插值进行采样</td></tr>
<tr><td>GL_NEAREST_MIPMAP_LINEAR</td><td>在两个最匹配像素大小的多级渐远纹理之间进行线性插值，使用邻近插值进行采样</td></tr>
<tr class='tr_hight'><td>GL_LINEAR_MIPMAP_LINEAR</td><td>在两个邻近的多级渐远纹理之间使用线性插值，并使用线性插值进行采样</td></tr>
</table>
</div>
<p>就像纹理过滤一样，我们可以使用<span class='mark'>glTexParameteri</span>将过滤方式设置为前面四种提到的方法之一：</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_MIN_FILTER</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_LINEAR_MIPMAP_LINEAR</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_MAG_FILTER</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_LINEAR</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>一个常见的错误是，将放大过滤的选项设置为多级渐远纹理过滤选项之一。这样没有任何效果，因为多级渐远纹理主要是使用在纹理被缩小的情况下的：纹理放大不会使用多级渐远纹理，为放大过滤设置多级渐远纹理的选项会产生一个<span class='mark'>GL_INVALID_ENUM</span>错误代码。</p>
<div><h2 class='h_option anchor_point' name='a_f'>像素提取</h2></div>
<div class='div_hightlight' style='background-color:skyblue;color:black'>
<p>在创建纹理之前，我们需要获取图片的像素信息，在<span class='mark'>.Net Framework</span>中我们可以使用<span class='mark'>System.Drawing.Bitmap</span>，但是很遗憾<span class='mark'>Bitmap</span>对象仅存在<span class='mark'>.Net Framework</span>中。如果程序仅运行在<span class='mark'>Windows</span>系统中，读者可以使用<span class='mark'>Bitmap</span>对象。作者也在抽空尝试编写解析图片像素的程序。但是在目前的教程中，我们采用<span class='mark'>Bitmap</span>对象进行像素获取。</p>
</div>
<p>读者目前可以使用第三方库，比如<span class='mark'>SharpImage</span>，或者作者在这里提供了一个简易的类。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(0,255,0,1)'>/*
<span class='span_code_line'></span> * Note: this code can only run in .Net Framework.
<span class='span_code_line'></span> * Becasue .Net Core or .NetX not have System.Drawing.Bitmap;
<span class='span_code_line'></span> */</span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>public class</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span>
<span class='span_code_line'></span><span style='color:rgba(255,255,255,1)'>{</span>
<span class='span_code_line'></span>    <span style='color:rgba(30,144,255,1)'>public struct</span> <span style='color:rgba(0,255,255,1)'>PixelsInfo</span>
<span class='span_code_line'></span>    <span style='color:rgba(255,255,255,1)'>{</span>
<span class='span_code_line'></span>        <span style='color:rgba(30,144,255,1)'>public</span> <span style='color:rgba(100,149,237,1)'>int</span> Width<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        <span style='color:rgba(30,144,255,1)'>public</span> <span style='color:rgba(100,149,237,1)'>int</span> Height<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        <span style='color:rgba(30,144,255,1)'>public</span> <span style='color:rgba(100,149,237,1)'>int</span> Channel<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        <span style='color:rgba(30,144,255,1)'>public</span> <span style='color:rgba(100,149,237,1)'>byte</span><span style='color:rgba(255,255,255,1)'>[]</span> Pixels<span style='color:rgba(255,255,255,1)'>;
<span class='span_code_line'></span>    }</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span>    <span style='color:rgba(30,144,255,1)'>public static</span> <span style='color:rgba(0,255,255,1)'>PixelsInfo</span> <span style='color:rgba(255,0,255,1)'>GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>string</span> strImageFile<span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span> format<span style='color:rgba(255,255,255,1)'>) {</span>
<span class='span_code_line'></span>        <span style='color:rgba(0,255,255,1)'>PixelsInfo</span> pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(30,144,255,1)'>new</span> <span style='color:rgba(0,255,255,1)'>PixelsInfo</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>        <span style='color:rgba(0,255,255,1)'>Bitmap</span> bmp <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>Bitmap</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>Bitmap</span><span style='color:rgba(219,112,147,1)'>.FromFile</span><span style='color:rgba(255,255,255,1)'>(</span>strImageFile<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>        <span style='color:rgba(0,255,255,1)'>BitmapData</span> bmpData <span style='color:rgba(255,255,255,1)'>=</span> bmp<span style='color:rgba(219,112,147,1)'>.LockBits</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(30,144,255,1)'>new</span> <span style='color:rgba(0,255,255,1)'>Rectangle</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>Point</span><span style='color:rgba(112,128,144,1)'>.Empty</span><span style='color:rgba(255,255,255,1)'>,</span> bmp<span style='color:rgba(112,128,144,1)'>.Size</span><span style='color:rgba(255,255,255,1)'>),</span> <span style='color:rgba(0,255,255,1)'>ImageLockMode</span><span style='color:rgba(112,128,144,1)'>.ReadOnly</span><span style='color:rgba(255,255,255,1)'>,</span> format<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>        pi<span style='color:rgba(112,128,144,1)'>.Width</span> <span style='color:rgba(255,255,255,1)'>=</span> bmp<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        pi<span style='color:rgba(112,128,144,1)'>.Height</span> <span style='color:rgba(255,255,255,1)'>=</span> bmp<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        pi<span style='color:rgba(112,128,144,1)'>.Channel</span> <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(255,255,255,1)'>(</span>bmpData<span style='color:rgba(112,128,144,1)'>.Stride</span> <span style='color:rgba(255,255,255,1)'>/</span> <span style='color:rgba(144,238,144,1)'>4</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(144,238,144,1)'>4</span><span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(255,255,255,1)'>/</span> bmp<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        pi<span style='color:rgba(112,128,144,1)'>.Pixels</span> <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(30,144,255,1)'>new</span> <span style='color:rgba(100,149,237,1)'>byte</span><span style='color:rgba(255,255,255,1)'>[</span>pi<span style='color:rgba(112,128,144,1)'>.Width</span> <span style='color:rgba(255,255,255,1)'>*</span> pi<span style='color:rgba(112,128,144,1)'>.Height</span> <span style='color:rgba(255,255,255,1)'>*</span> pi<span style='color:rgba(112,128,144,1)'>.Channel</span><span style='color:rgba(255,255,255,1)'>];</span>
<span class='span_code_line'></span>        <span style='color:rgba(100,149,237,1)'>byte</span><span style='color:rgba(255,255,255,1)'>[]</span> bySrc <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(30,144,255,1)'>new</span> <span style='color:rgba(100,149,237,1)'>byte</span><span style='color:rgba(255,255,255,1)'>[</span>bmpData<span style='color:rgba(112,128,144,1)'>.Stride</span> <span style='color:rgba(255,255,255,1)'>*</span> bmpData<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>];</span>
<span class='span_code_line'></span>        <span style='color:rgba(0,255,255,1)'>Marshal</span><span style='color:rgba(219,112,147,1)'>.Copy</span><span style='color:rgba(255,255,255,1)'>(</span>bmpData<span style='color:rgba(112,128,144,1)'>.Scan0</span><span style='color:rgba(255,255,255,1)'>,</span> bySrc<span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span> bySrc<span style='color:rgba(112,128,144,1)'>.Length</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>        <span style='color:rgba(100,149,237,1)'>int</span> nLineWidth <span style='color:rgba(255,255,255,1)'>=</span> pi<span style='color:rgba(112,128,144,1)'>.Channel</span> <span style='color:rgba(255,255,255,1)'>*</span> pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        <span style='color:rgba(100,149,237,1)'>int</span> nIndexDst <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        <span style='color:rgba(100,149,237,1)'>int</span> nIndexSrc <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(255,255,255,1)'>(</span>bmp<span style='color:rgba(112,128,144,1)'>.Height</span> <span style='color:rgba(255,255,255,1)'>-</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(255,255,255,1)'>*</span> bmpData<span style='color:rgba(112,128,144,1)'>.Stride</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>        <span style='color:rgba(30,144,255,1)'>for</span> <span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>int</span> y <span style='color:rgba(255,255,255,1)'>=</span> bmp<span style='color:rgba(112,128,144,1)'>.Height</span> <span style='color:rgba(255,255,255,1)'>-</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>;</span> y <span style='color:rgba(255,255,255,1)'>&gt;</span><span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>;</span> y<span style='color:rgba(255,255,255,1)'>--</span><span style='color:rgba(255,255,255,1)'>) {</span>
<span class='span_code_line'></span>            <span style='color:rgba(30,144,255,1)'>for</span> <span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>int</span> x <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span> nLen <span style='color:rgba(255,255,255,1)'>=</span> bmp<span style='color:rgba(112,128,144,1)'>.Width</span> <span style='color:rgba(255,255,255,1)'>*</span> pi<span style='color:rgba(112,128,144,1)'>.Channel</span><span style='color:rgba(255,255,255,1)'>;</span> x <span style='color:rgba(255,255,255,1)'>&lt;</span> nLen<span style='color:rgba(255,255,255,1)'>;</span> x <span style='color:rgba(255,255,255,1)'>+=</span> pi<span style='color:rgba(112,128,144,1)'>.Channel</span><span style='color:rgba(255,255,255,1)'>) {</span>
<span class='span_code_line'></span>                <span style='color:rgba(100,149,237,1)'>int</span> nTemp <span style='color:rgba(255,255,255,1)'>=</span> nIndexSrc <span style='color:rgba(255,255,255,1)'>+</span> x <span style='color:rgba(255,255,255,1)'>+</span> pi<span style='color:rgba(112,128,144,1)'>.Channel</span> <span style='color:rgba(255,255,255,1)'>-</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>                <span style='color:rgba(30,144,255,1)'>for</span> <span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>int</span> c <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>;</span> c <span style='color:rgba(255,255,255,1)'>&lt;</span> pi<span style='color:rgba(112,128,144,1)'>.Channel</span><span style='color:rgba(255,255,255,1)'>;</span> c<span style='color:rgba(255,255,255,1)'>++</span><span style='color:rgba(255,255,255,1)'>) {</span>
<span class='span_code_line'></span>                    pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>[</span>nIndexDst<span style='color:rgba(255,255,255,1)'>++</span><span style='color:rgba(255,255,255,1)'>]</span> <span style='color:rgba(255,255,255,1)'>=</span> bySrc<span style='color:rgba(255,255,255,1)'>[</span>nTemp <span style='color:rgba(255,255,255,1)'>-</span> c<span style='color:rgba(255,255,255,1)'>];
<span class='span_code_line'></span>                }
<span class='span_code_line'></span>            }</span>
<span class='span_code_line'></span>            nIndexSrc <span style='color:rgba(255,255,255,1)'>-=</span> bmpData<span style='color:rgba(112,128,144,1)'>.Stride</span><span style='color:rgba(255,255,255,1)'>;
<span class='span_code_line'></span>        }</span>
<span class='span_code_line'></span>        bmp<span style='color:rgba(219,112,147,1)'>.UnlockBits</span><span style='color:rgba(255,255,255,1)'>(</span>bmpData<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>        bmp<span style='color:rgba(219,112,147,1)'>.Dispose</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>        <span style='color:rgba(30,144,255,1)'>return</span> pi<span style='color:rgba(255,255,255,1)'>;
<span class='span_code_line'></span>    }
<span class='span_code_line'></span>}</span></pre>
</div>
<div><h2 class='h_option anchor_point' name='a_g'>创建纹理</h2></div>
<p>我们以<span class='mark'>你好 四边形</span>作为案例进行代码修改，首先顶点数据中我们需要添加纹理坐标。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>[]</span> vertices <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(255,255,255,1)'>{</span>
<span class='span_code_line'></span>    <span style='color:rgba(0,255,0,1)'>// location             // color            // texcoord</span>
<span class='span_code_line'></span>    <span style='color:rgba(255,255,255,1)'>-</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span>  <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span>     <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>1f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span>   <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 左上角</span>
<span class='span_code_line'></span>     <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span>  <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span>     <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>1f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span>   <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 右上角</span>
<span class='span_code_line'></span>     <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(255,255,255,1)'>-</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span>     <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>1f</span><span style='color:rgba(255,255,255,1)'>,</span>   <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 右下角</span>
<span class='span_code_line'></span>    <span style='color:rgba(255,255,255,1)'>-</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(255,255,255,1)'>-</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>5f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span>     <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>1f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>1f</span><span style='color:rgba(255,255,255,1)'>,</span>   <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0f</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 左下角</span>
<span class='span_code_line'></span><span style='color:rgba(255,255,255,1)'>};</span></pre>
</div>
<p>你可以看到现在有3组数据在里面，聪明的你肯定已经知道如何设置顶点属性。</p>
<img src='../images/1.7.vertex_attribute_pointer_interleaved_textures.png'/>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.VertexAttribPointer</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>3</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_FLOAT</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(30,144,255,1)'>false</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>8</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(100,149,237,1)'>sizeof</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>),</span> <span style='color:rgba(0,255,255,1)'>IntPtr</span><span style='color:rgba(112,128,144,1)'>.Zero</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.EnableVertexAttribArray</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.VertexAttribPointer</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>3</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_FLOAT</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(30,144,255,1)'>false</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>8</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(100,149,237,1)'>sizeof</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>), (</span>IntPtr<span style='color:rgba(255,255,255,1)'>)(</span><span style='color:rgba(144,238,144,1)'>3</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(100,149,237,1)'>sizeof</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>)));</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.EnableVertexAttribArray</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.VertexAttribPointer</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>2</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>3</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_FLOAT</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(30,144,255,1)'>false</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>8</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(100,149,237,1)'>sizeof</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>), (</span>IntPtr<span style='color:rgba(255,255,255,1)'>)(</span><span style='color:rgba(144,238,144,1)'>6</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(100,149,237,1)'>sizeof</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>float</span><span style='color:rgba(255,255,255,1)'>)));</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.EnableVertexAttribArray</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>2</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>同样我们也需要修改顶点着色器</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span>#version <span style='color:rgba(144,238,144,1)'>330</span> <span style='color:rgba(0,255,255,1)'>core</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(255,0,255,1)'>layout</span> <span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>location</span> <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(30,144,255,1)'>in</span> vec3 dotPos<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span><span style='color:rgba(219,112,147,1)'>layout</span> <span style='color:rgba(255,255,255,1)'>(</span>location <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(30,144,255,1)'>in</span> vec3 dotColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span><span style='color:rgba(219,112,147,1)'>layout</span> <span style='color:rgba(255,255,255,1)'>(</span>location <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(144,238,144,1)'>2</span><span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(30,144,255,1)'>in</span> vec2 dotTexCoord<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>out</span> vec3 DotColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>out</span> vec2 DotTexCoord<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>void</span> <span style='color:rgba(255,0,255,1)'>main</span><span style='color:rgba(255,255,255,1)'>(){</span>
<span class='span_code_line'></span>    gl_Position <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(219,112,147,1)'>vec4</span><span style='color:rgba(255,255,255,1)'>(</span>dotPos<span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>    DotColor <span style='color:rgba(255,255,255,1)'>=</span> dotColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>    DotTexCoord <span style='color:rgba(255,255,255,1)'>=</span> dotTexCoord<span style='color:rgba(255,255,255,1)'>;
<span class='span_code_line'></span>}</span></pre>
</div>
<p>片段着色器。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span>#version <span style='color:rgba(144,238,144,1)'>330</span> core
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>in</span> vec3 DotColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>in</span> vec2 DotTexCoord<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>out</span> vec4 fragColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span>uniform sampler2D u_texture<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>void</span> <span style='color:rgba(255,0,255,1)'>main</span><span style='color:rgba(255,255,255,1)'>(){</span>
<span class='span_code_line'></span>    fragColor <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(219,112,147,1)'>texture</span><span style='color:rgba(255,255,255,1)'>(</span>u_texture<span style='color:rgba(255,255,255,1)'>,</span> DotTexCoord<span style='color:rgba(255,255,255,1)'>);
<span class='span_code_line'></span>}</span></pre>
</div>
<p><span class='mark'>texture</span>是<span class='mark'>GLSL</span>的一个内置函数，可以合成我们需要的像素颜色，他需要一个纹理和坐标作为参数。接下来就是如何传递纹理给<span class='mark'>u_texture</span>了。和其他对象创建一下我们需要<span class='mark'>glGenXXX</span><span class='mark'>glBindXXX</span>。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> texture <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.GenTextures</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.BindTexture</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> texture<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_WRAP_S</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_REPEAT</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_WRAP_T</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_REPEAT</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_MIN_FILTER</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_LINEAR</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexParameteri</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_MAG_FILTER</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_LINEAR</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>接下来是准备好像素数据然后传递给<span class='mark'>texture</span>。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span><span style='color:rgba(219,112,147,1)'>.GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"./container.png"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span><span style='color:rgba(112,128,144,1)'>.Format24bppRgb</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>IntPtr</span> ptr <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>Marshal</span><span style='color:rgba(219,112,147,1)'>.AllocHGlobal</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels.Length</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>Marshal</span><span style='color:rgba(219,112,147,1)'>.Copy</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span> ptr<span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Pixels.Length</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.TexImage2D</span><span style='color:rgba(255,255,255,1)'>(</span>
<span class='span_code_line'></span>    <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>,</span>
<span class='span_code_line'></span>    <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span>              <span style='color:rgba(0,255,0,1)'>// 指定多级渐远纹理的级别，我们不使用手动，填写0。</span>
<span class='span_code_line'></span>    <span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,0,1)'>// 告诉OpenGL以什么样的数据格式保存</span>
<span class='span_code_line'></span>    pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>,</span>
<span class='span_code_line'></span>    pi<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>,</span>
<span class='span_code_line'></span>    <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span>              <span style='color:rgba(0,255,0,1)'>// 历史原因，反正填写0就对了。</span>
<span class='span_code_line'></span>    <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span>      <span style='color:rgba(0,255,0,1)'>// 像素的数据格式</span>
<span class='span_code_line'></span>    <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_UNSIGNED_BYTE</span><span style='color:rgba(255,255,255,1)'>,</span>    <span style='color:rgba(0,255,0,1)'>// 像素是无符号byte</span>
<span class='span_code_line'></span>    ptr             <span style='color:rgba(0,255,0,1)'>// 像素数据。</span>
<span class='span_code_line'></span>    <span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>Marshal</span><span style='color:rgba(219,112,147,1)'>.FreeHGlobal</span><span style='color:rgba(255,255,255,1)'>(</span>ptr<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.GenerateMipmap</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_TEXTURE_2D</span><span style='color:rgba(255,255,255,1)'>);</span>    <span style='color:rgba(0,255,0,1)'>// 创建多级纹理</span></pre>
</div>
<p>当调用<span class='mark'>glTexImage2D</span>时，当前绑定的纹理对象就会被附加上纹理图像。然而，目前只有基本级别(Base-level)的纹理图像被加载了，如果要使用多级渐远纹理，我们必须手动设置所有不同的图像（不断递增第二个参数）。或者，直接在生成纹理之后调用<span class='mark'>glGenerateMipmap</span>。这会为当前绑定的纹理自动生成所有需要的多级渐远纹理。</p>
<div class='div_hightlight' style='background-color:yellowgreen;color:black'>
<p>在<span class='mark'>STGL</span>中已经对2D纹理进行了部分的封装，你可以使用下面的代码。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span><span style='color:rgba(219,112,147,1)'>.GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"./container.png"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span><span style='color:rgba(112,128,144,1)'>.Format24bppRgb</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> texture <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>texture<span style='color:rgba(219,112,147,1)'>.SetPixels</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
</div>
<p>然后运行程序你就会看到如下的效果。</p>
<img src='../images/1.7.result_texture.png'/>
<p>在<span class='mark'>vertices</span>和顶点着色器中没有还加入了颜色，如果我们将片段着色器改成如下代码。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span>fragColor <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(219,112,147,1)'>texture</span><span style='color:rgba(255,255,255,1)'>(</span>u_texture<span style='color:rgba(255,255,255,1)'>,</span> DotTexCoord<span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(219,112,147,1)'>vec4</span><span style='color:rgba(255,255,255,1)'>(</span>DotColor<span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>你将看到如下混合效果。</p>
<img src='../images/1.7.result_texture_color.png'/>
<div><h2 class='h_option anchor_point' name='a_h'>纹理单元</h2></div>
<p>不知道读者有没有注意到，在上面的代码，我们并没有对片段着色器中的<span class='mark'>u_texture</span>赋值，但是却可以得到正确的效果。是的，纹理的赋值比较特殊，之前的赋值我们是通过<span class='mark'>glUniformX(name,value...)</span>的方式赋值的，如果确实要通过<span class='mark'>glUniformX</span>去赋值的话那么<span class='mark'>value</span>必然就是<span class='mark'>像素</span>。</p>
<p>可是<span class='mark'>像素</span>我们已经通过<span class='mark'>glTexImage2D</span>拷贝到了显卡中了。无需再赋值了，那么既然已经不用赋值了<span class='mark'>uniform sampler2D u_texture;</span>的意义又在哪里呢？</p>
<p>当然有意义，我们只是不用通过<span class='mark'>glUniformX</span>去赋值像素数据了，那么，如果想使用多个纹理怎么办？</p>
<p>还记得之前<span class='mark'>VAO</span>中的<span class='mark'>attribute pointer</span>吗？纹理和这个差不多。也是通过这样的方式进行数据关联，称之为<span class='mark'>纹理单元</span>。因为我们并没有编写额外的代码，所以我们的纹理被绑定到了<span class='mark'>0</span>号单元上，它是默认被激活的。</p>
<p>而当我们要使用多个纹理的时候，就必须额外的激活其他的纹理单元，通过<span class='mark'>glActiveTexture</span>函数可以激活一个纹理单元。我们应当是先激活纹理单元再绑定纹理。</p>
<div class='div_hightlight' style='background-color:yellowgreen;color:black'>
<p><span class='mark'>OpenGL</span>至少保证有<span class='mark'>16</span>个纹理单元供你使用，也就是说你可以激活从<span class='mark'>GL_TEXTURE0</span>到<span class='mark'>GL_TEXTRUE15</span>。它们都是按顺序定义的，所以我们也可以通过<span class='mark'>GL_TEXTURE0 + 8</span>的方式获得<span class='mark'>GL_TEXTURE8</span>，这在当我们需要循环一些纹理单元的时候会很有用。</p>
</div>
<p>接下来我们修改一下片段着色器代码。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span>#version <span style='color:rgba(144,238,144,1)'>330</span> core
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>in</span> vec3 DotColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>in</span> vec2 DotTexCoord<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(30,144,255,1)'>out</span> vec4 fragColor<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span>uniform sampler2D u_texture_1<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>uniform sampler2D u_texture_2<span style='color:rgba(255,255,255,1)'>;</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>void</span> <span style='color:rgba(255,0,255,1)'>main</span><span style='color:rgba(255,255,255,1)'>(){</span>
<span class='span_code_line'></span>    fragColor <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(219,112,147,1)'>mix</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(219,112,147,1)'>texture</span><span style='color:rgba(255,255,255,1)'>(</span>u_texture_1<span style='color:rgba(255,255,255,1)'>,</span> DotTexCoord<span style='color:rgba(255,255,255,1)'>),</span> <span style='color:rgba(219,112,147,1)'>texture</span><span style='color:rgba(255,255,255,1)'>(</span>u_texture_2<span style='color:rgba(255,255,255,1)'>,</span> DotTexCoord<span style='color:rgba(255,255,255,1)'>),</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>2</span><span style='color:rgba(255,255,255,1)'>);
<span class='span_code_line'></span>}</span><span style='color:rgba(255,165,0,1)'>";</span></pre>
</div>
<p>在着色器中接收两个纹理，所以我们也要创建两个纹理。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span><span style='color:rgba(219,112,147,1)'>.GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"./container.png"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span><span style='color:rgba(112,128,144,1)'>.Format24bppRgb</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> texture_1 <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>texture_1<span style='color:rgba(219,112,147,1)'>.BindUnit</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(112,128,144,1)'>.Unit.Texture00</span><span style='color:rgba(255,255,255,1)'>);</span> <span style='color:rgba(0,255,0,1)'>// 绑定到0号通道</span>
<span class='span_code_line'></span>texture_1<span style='color:rgba(219,112,147,1)'>.SetPixels</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span>pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span><span style='color:rgba(219,112,147,1)'>.GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"./awesomeface.png"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span><span style='color:rgba(112,128,144,1)'>.Format24bppRgb</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> texture_2 <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(112,128,144,1)'>.Unit.Texture01</span><span style='color:rgba(255,255,255,1)'>);</span> <span style='color:rgba(0,255,0,1)'>// 创建时候就绑定到1号通道。</span>
<span class='span_code_line'></span>texture_2<span style='color:rgba(219,112,147,1)'>.SetPixels</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.SetUniform</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"u_texture_1"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.SetUniform</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"u_texture_2"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<div class='div_hightlight' style='background-color:pink;color:black'>
<p>注意：代码不能写成下面的样子。</p>
</div>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span><span style='color:rgba(219,112,147,1)'>.GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"./container.png"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span><span style='color:rgba(112,128,144,1)'>.Format24bppRgb</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> texture_1 <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>();</span><span style='color:rgba(0,255,0,1)'>// 若没有绑定，默认是0号通道。</span>
<span class='span_code_line'></span>texture_1<span style='color:rgba(219,112,147,1)'>.SetPixels</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>);</span><span style='color:rgba(0,255,0,1)'>// 此时活动通道是0号</span>
<span class='span_code_line'></span>texture_1<span style='color:rgba(219,112,147,1)'>.BindUnit</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(112,128,144,1)'>.Unit.Texture00</span><span style='color:rgba(255,255,255,1)'>);</span> <span style='color:rgba(0,255,0,1)'>// 激活并关联到0号通道。</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span>pi <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>PixelsHelper</span><span style='color:rgba(219,112,147,1)'>.GetPixelsInfo</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"./awesomeface.png"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>PixelFormat</span><span style='color:rgba(112,128,144,1)'>.Format24bppRgb</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> texture_2 <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>texture_2<span style='color:rgba(219,112,147,1)'>.SetPixels</span><span style='color:rgba(255,255,255,1)'>(</span>pi<span style='color:rgba(112,128,144,1)'>.Pixels</span><span style='color:rgba(255,255,255,1)'>, (</span><span style='color:rgba(100,149,237,1)'>int</span><span style='color:rgba(255,255,255,1)'>)</span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Width</span><span style='color:rgba(255,255,255,1)'>,</span> pi<span style='color:rgba(112,128,144,1)'>.Height</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(112,128,144,1)'>.GL_RGB</span><span style='color:rgba(255,255,255,1)'>);</span><span style='color:rgba(0,255,0,1)'>// 此时活动通道还是0号</span>
<span class='span_code_line'></span>texture_2<span style='color:rgba(219,112,147,1)'>.BindUnit</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(112,128,144,1)'>.Unit.Texture01</span><span style='color:rgba(255,255,255,1)'>);</span> <span style='color:rgba(0,255,0,1)'>// 虽然数据会关联定到1号通道，但是上一句代码已经覆盖掉了原本0号通道的关联。</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> program <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLProgram</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>(</span>m_str_vertex_shader<span style='color:rgba(255,255,255,1)'>,</span> m_str_fragment_shader<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.Use</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.SetUniform</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"u_texture_1"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.SetUniform</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"u_texture_2"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>虽然我们在设置顶点属性的时候用的是如下的代码。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.VertexAttribPointer</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>3</span><span style='color:rgba(255,255,255,1)'>,</span> ...<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.EnableVertexAttribArray</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.VertexAttribPointer</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>3</span><span style='color:rgba(255,255,255,1)'>,</span> ...<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span><span style='color:rgba(0,255,255,1)'>GL</span><span style='color:rgba(219,112,147,1)'>.EnableVertexAttribArray</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>但是可以看到我们在设置顶点属性的时候是指定了通道号的，而纹理的设置函数中并没有这个参数，只能通过<span class='mark'>glActiveTexture</span>来激活一个通道。而<span class='mark'>SetPixels</span>内部调用的是<span class='mark'>glTexImage2D</span>函数，<span style='color:pink'>它会自动关联当前活动的通道</span>，所以在没有激活新的通道时会导致第二次的<span class='mark'>SetPixels</span>自动关联到上一个的通道。当然如果写成下面的形式也是可以的。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span style='color:rgba(100,149,237,1)'>var</span> program <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(0,255,255,1)'>GLProgram</span><span style='color:rgba(219,112,147,1)'>.Create</span><span style='color:rgba(255,255,255,1)'>(</span>m_str_vertex_shader<span style='color:rgba(255,255,255,1)'>,</span> m_str_fragment_shader<span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.Use</span><span style='color:rgba(255,255,255,1)'>();</span>
<span class='span_code_line'></span>texture_1<span style='color:rgba(219,112,147,1)'>.BindUnit</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(112,128,144,1)'>.Unit.Texture00</span><span style='color:rgba(255,255,255,1)'>);</span> <span style='color:rgba(0,255,0,1)'>// 激活并关联到0号通道。</span>
<span class='span_code_line'></span>texture_2<span style='color:rgba(219,112,147,1)'>.BindUnit</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(0,255,255,1)'>GLTexture2D</span><span style='color:rgba(112,128,144,1)'>.Unit.Texture01</span><span style='color:rgba(255,255,255,1)'>);</span> <span style='color:rgba(0,255,0,1)'>// 激活并关联到1号通道。</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.SetUniform</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"u_texture_1"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(255,255,255,1)'>);</span>
<span class='span_code_line'></span>program<span style='color:rgba(219,112,147,1)'>.SetUniform</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(255,165,0,1)'>"u_texture_2"</span><span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>
<p>运行后你会看到如下效果。</p>
<img src='../images/1.7.texture_mix.png'/>
<p>同样你也可以在片段着色器中将我们传入的颜色也一起混合。</p>
<div class='div_code'>
<pre class='pre_code'><span class='span_code_line'></span><span>fragColor <span style='color:rgba(255,255,255,1)'>=</span> <span style='color:rgba(219,112,147,1)'>mix</span><span style='color:rgba(255,255,255,1)'>(</span><span style='color:rgba(219,112,147,1)'>texture</span><span style='color:rgba(255,255,255,1)'>(</span>u_texture_1<span style='color:rgba(255,255,255,1)'>,</span> DotTexCoord<span style='color:rgba(255,255,255,1)'>),</span> <span style='color:rgba(219,112,147,1)'>texture</span><span style='color:rgba(255,255,255,1)'>(</span>u_texture_2<span style='color:rgba(255,255,255,1)'>,</span> DotTexCoord<span style='color:rgba(255,255,255,1)'>),</span> <span style='color:rgba(144,238,144,1)'>0</span><span style='color:rgba(112,128,144,1)'>.</span><span style='color:rgba(144,238,144,1)'>2</span><span style='color:rgba(255,255,255,1)'>)</span> <span style='color:rgba(255,255,255,1)'>*</span> <span style='color:rgba(219,112,147,1)'>vec4</span><span style='color:rgba(255,255,255,1)'>(</span>DotColor<span style='color:rgba(255,255,255,1)'>,</span> <span style='color:rgba(144,238,144,1)'>1</span><span style='color:rgba(255,255,255,1)'>);</span></pre>
</div>

</div>
<div id="div_right_list">
<a name='a_a' href='#a_a'>纹理</a>
<a name='a_b' href='#a_b'>纹理坐标</a>
<a name='a_c' href='#a_c'>纹理的环绕方式</a>
<a name='a_d' href='#a_d'>纹理过滤</a>
<a name='a_e' href='#a_e'>多级渐远纹理</a>
<a name='a_f' href='#a_f'>像素提取</a>
<a name='a_g' href='#a_g'>创建纹理</a>
<a name='a_h' href='#a_h'>纹理单元</a>
</div>
</div>
</body>
</html>
